/*!
 * create-app.js v0.1.1
 * (c) 2016 Jade Gu
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("history/lib/createMemoryHistory"),require("path-to-regexp"),require("history/lib/createBrowserHistory"),require("history/lib/createHashHistory"),require("history/lib/useQueries"),require("history/lib/useBeforeUnload"),require("history/lib/useBasename")):"function"==typeof define&&define.amd?define(["history/lib/createMemoryHistory","path-to-regexp","history/lib/createBrowserHistory","history/lib/createHashHistory","history/lib/useQueries","history/lib/useBeforeUnload","history/lib/useBasename"],t):e.App=t(e.createMemoryHistory,e.pathToRegexp,e.createHistory,e.createHashHistory,e.useQueries,e.useBeforeUnload,e.useBasename)}(this,function(e,t,r,o,n,i,a){"use strict";function u(e){return null!=e&&"function"==typeof e.then}function c(e){return e}function p(e,t){if(!t)return e;for(var r=Object.keys(t),o=r.length;o--;)e[r[o]]=t[r[o]];return e}function l(e){var t=e.map(s),r=t.length;return function(e){for(var o=y(e),n=0;n<r;n++){var i=t[n],a=i.regexp.exec(o);if(a){var u=f(a,i.keys),c=i.controller;return{path:i.path,params:u,controller:c}}}}}function s(e){var r=p({},e),o=r.keys=[];return r.regexp=t(r.path,o),r}function f(e,t){for(var r={},o=1,n=e.length;o<n;o++){var i=t[o-1];i&&("string"==typeof e[o]?r[i.name]=decodeURIComponent(e[o]):r[i.name]=e[o])}return r}function y(e){return e.replace(/\/\//g,"/")}function h(e){function t(){return j?j:j="string"==typeof B?document.querySelector(B):B}function r(e){var t="string"==typeof e?C.createLocation(e):e;if(O){var r=O.pathname===t.pathname,o=O.search===t.search,i=O.hash===t.hash;if(r&&o&&i)return}O=t;var a=H(t.pathname);if(!a)throw new Error("Did not match any route with pathname:"+t.pathname);var c=a.path,p=a.params,l=a.controller;t.pattern=c,t.params=p;var s=typeof l,f=n(t);if("string"===s){var y=v(l,f,t);return u(y)?y.then(f):y}if("function"===s){var y=l(t,v);return u(y)?y.then(f):f(y)}}function o(e,r){if(U.hasOwnProperty(e))return U[e];var o=function(e){function r(t,o){m.classCallCheck(this,r),e.call(this,t,o),this.location=this.location||t,this.context=this.context||o}return m.inherits(r,e),r.prototype.goReplace=function(t){e.prototype.goReplace&&e.prototype.goReplace.call(this,t),C.replace(t)},r.prototype.goTo=function(t){e.prototype.goTo&&e.prototype.goTo.call(this,t),C.push(t)},r.prototype.goIndex=function(t){e.prototype.goIndex&&e.prototype.goIndex.call(this,t),C.go(t)},r.prototype.goBack=function(){e.prototype.goBack&&e.prototype.goBack.call(this),C.goBack()},r.prototype.goForward=function(){e.prototype.goForward&&e.prototype.goForward.call(this),C.goForward()},r.prototype.refreshView=function(){return e.prototype.refreshView&&e.prototype.refreshView.call(this),i(this.render())},r.prototype.getContainer=function(){return e.prototype.getContainer&&e.prototype.getContainer.call(this),t()},r.prototype.clearContainer=function(){return e.prototype.clearContainer&&e.prototype.clearContainer.call(this),a()},r}(r);return U[e]=o,o}function n(e){return function(t){if(O===e){k&&c();var r=o(e.pattern,t),n=k=new r(e,b),a=null,p=null;if(n.beforeLeave){var l=n.beforeLeave.bind(n);a=C.listenBefore(l)}if(n.beforeUnload){var s=n.beforeUnload.bind(n);p=C.listenBeforeUnload(s)}n.$unlisten=function(){a&&(a(),a=null),p&&(p(),p=null)};var f=n.init();return f?u(f)?f.then(i):i(f):null}}}function i(e){return g.render(e,t())}function a(){if(g.clear)return g.clear(t())}function c(){k&&(k.$unlisten(),k.destroy&&k.destroy(),k=null),a()}function s(e,t){var o=function(t){var o=r(t);e&&(u(o)?o.then(function(){return e(t)}):e(t))};T=C.listen(o),t!==!1&&o(C.getCurrentLocation())}function f(){T&&(T(),T=null),c()}var y=p({viewEngine:x},w);p(y,e);var h=y.routes,g=y.viewEngine,v=y.loader,b=y.context,B=y.container,C=d(y),H=l(h),k=null,O=null,T=null,j=null,U={};return{start:s,stop:f,render:r,history:C}}function d(e){var t=B[e.type];return t=B.useBasename(t),t=B.useBeforeUnload(t),(t=B.useQueries(t))(e)}function g(e){function t(e,t){var r=d.createLocation(e),n=h(r.pathname);if(!n)return void t(new Error("Did not match any route with path:"+e));var i=n.path,a=n.params,c=n.controller;r.pattern=i,r.params=a;var p=o(r,t),l=typeof c;if("string"===l){var s=f(c,p,r);return u(s)?s.then(p,t):s}if("function"===l){var s=c(r,f);return u(s)?s.then(p,t):p(s)}}function r(e,r){if(g.hasOwnProperty(e))return g[e];var o=function(e){function r(t,o){m.classCallCheck(this,r),e.call(this,t,o),this.location=this.location||t,this.context=this.context||o}return m.inherits(r,e),r.prototype.goReplace=function(r){return e.prototype.goReplace&&e.prototype.goReplace.call(this,r),t(r)},r.prototype.goTo=function(r){return e.prototype.goTo&&e.prototype.goTo.call(this,r),t(r)},r.prototype.goIndex=function(t){e.prototype.goIndex&&e.prototype.goIndex.call(this,t)},r.prototype.goBack=function(){e.prototype.goBack&&e.prototype.goBack.call(this)},r.prototype.goForward=function(){e.prototype.goForward&&e.prototype.goForward.call(this)},r.prototype.refreshView=function(){e.prototype.refreshView&&e.prototype.refreshView.call(this)},r.prototype.getContainer=function(){e.prototype.getContainer&&e.prototype.getContainer.call(this)},r.prototype.clearContainer=function(){e.prototype.clearContainer&&e.prototype.clearContainer.call(this)},r}(r);return g[e]=o,o}function o(e,t){return function(o){var i=r(e.pattern,o),a=new i(e,y),c=a.init();if(u(c)){var p=c.then(n);return t?p.then(function(e){return t(null,e)},t):p}var l=n(c);return t&&t(null,l),l}}function n(e){return s.render(e)}function i(e,r){try{return t(e,r)}catch(e){r(e)}}var a=p({viewEngine:H},w);p(a,e);var c=a.routes,s=a.viewEngine,f=a.loader,y=a.context,h=l(c),d=v(a),g={};return{render:i,history:d}}function v(t){var r=e;return r=B.useBasename(r),(r=B.useQueries(r))(t)}e="default"in e?e.default:e,t="default"in t?t.default:t,r="default"in r?r.default:r,o="default"in o?o.default:o,n="default"in n?n.default:n,i="default"in i?i.default:i,a="default"in a?a.default:a;var m={};m.inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},m.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Object.freeze||(Object.freeze=c);var w={container:"#container",basename:"",context:{},type:"createHistory"},b=function(e,t){return t.innerHTML=e,t},x=Object.freeze({render:b}),B={createHistory:r,createHashHistory:o,useQueries:n,useBeforeUnload:i,useBasename:a},C=function(e){return e.toString()},H=Object.freeze({render:C}),k={server:g,client:h};return k});